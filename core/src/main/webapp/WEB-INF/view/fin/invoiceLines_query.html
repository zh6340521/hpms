<#--
        * description: 应付行明细
        * version: 1.0
        * #copyright#
        *author: jun.guo@hand-china.com 2017.03.13
        -->
    <#include "../include/header.html">
        <body>
        <style type="text/css">
            .k-textbox {
                width: 180px;
                height: 25px;
            }
            .inputbox{
                width: 180px;
                height: 25px;
            }
        </style>

        <script type="text/javascript">
            var invoiceId= <#if RequestParameters.invoiceId?exists>
                           ${RequestParameters.invoiceId}
                           <#else>-1</#if>;

            var newViewModel = kendo.observable({
                model: {}
            });

        </script>

        <div id="page-content">

            <div style="clear:both">
                <div id="invoice_grid" ></div>
            </div>
            <script>kendo.bind($('#invoice_grid'), newViewModel);</script>
        </div>
        <script type="text/javascript" >


            var dataSource = new kendo.data.DataSource({
                transport   : {
                    read        : {
                        url     : _basePath+"/hpms/fin/invoice/line/query?invoiceId="+invoiceId,
                        type    : "POST",
                        dataType: "json"
                    },
                    parameterMap: function (options, type) {
                        if (type !== "read" && options.models) {
                            var datas = Hap.prepareSubmitParameter(options, type)
                            return kendo.stringify(datas);
                        } else if (type === "read") {
                            return Hap.prepareQueryParameter(newViewModel.model.toJSON(), options);

                        }
                    }
                },
                batch       : true,
                serverPaging: true,
                pageSize    : 10,
                schema      : {
                    data  : 'rows',
                    total : 'total',
                    model : {
                        id    : "invoiceLineId",
                        fields: {
                            invoiceId:{

                            },
                            lineNumner:{

                            },
                            feeName:{

                            },
                            feeId:{

                            },
                            accountNum:{

                            },
                            costCenter:{

                            },
                            profitCenter:{

                            },
                            lineAmount:{

                            },
                            taxCode:{

                            },
                            taxAmount:{

                            },
                            description:{

                            }

                        }
                    }
                }
            });
            var grid = $("#invoice_grid").kendoGrid({
                dataSource : dataSource,
                navigatable: false,
                height     : '100%',
                resizable  : true,
                scrollable : true,
                selectable : 'row',
                reorderable: true,
                pageable   : {
                    pageSizes  : [5, 10, 20, 50],
                    refresh    : true,
                    buttonCount: 5
                },
                columns    : [{
                    field      : "lineNumner",
                    title      : "<@spring.message 'hpms.fin.invoice.lineNumber'/>",
                    width      : 80,
                    attributes  : {style: "text-align:center"},
                    template: function(dataItem) {
                        //console.log(dataItem['lineNumner']);
                        return dataItem['lineNumner']||'';
                    },
                    editor: function(container, options){
                        container.html(options.model.lineNumner);
                        container.removeClass('k-edit-cell');
                    }

                },{
                    field      : "feeName",
                    title      : "<@spring.message 'hpms.fin.invoice.feeName'/>",
                    width      : 120,
                    attributes  : {style: "text-align:center"},
                    template:function(dataItem) {
                        return dataItem['feeName']||'';
                    },
                    editor: function(container, options){

                        if (options.model.invoiceLineId != "") {
                            container.html(options.model.feeName);
                            container.removeClass('k-edit-cell');
                        }else {
                            $('<input required validationMessage="必输" name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoDropDownList({
                                        dataTextField: "feeName",
                                        dataValueField: "feeName",
                                        valuePrimitive: true,
                                        dataSource:  {
                                            transport: {
                                                read:function(options) {
                                                    $.ajax({
                                                        type   : "POST",
                                                        url: "${base.contextPath}/hpms/mdm/fee/query?enableFlag="+'Y',
                                                        data: {},
                                                        success: function(json) {
                                                            options.success(json.rows);
                                                        }
                                                    });
                                                }
                                            }
                                        },
                                        select : function(e){
                                            var dataItem = this.dataItem(e.item);
                                            options.model.set('feeName',dataItem.feeName);
                                            options.model.set('feeId',dataItem.feeId);
                                        }
                                    });
                        }
                    }

                },{
                    field      : "accountNum",
                    title      : "<@spring.message 'hpms.fin.invoice.accountNum'/>",
                    width      : 120,
                    attributes : {style: "text-align:center"},
                    template:function(dataItem) {
                        return dataItem['accountNum']||'';
                    },
                    editor: function(container, options){

                        if (options.model.invoiceLineId != "") {
                            container.html(options.model.accountNum);
                            container.removeClass('k-edit-cell');
                        }else {
                            var editor = $('<input type="text" name="accountNum" class="k-input k-textbox">');
                            editor.css('width','100%');
                            container.append(editor);
                        }
                    }
                },{
                    field      : "costCenter",
                    title      : "<@spring.message 'hpms.fin.invoice.costCenter'/>",
                    width      : 120,
                    attributes : {style: "text-align:center"},
                    template:function(dataItem) {
                        return dataItem['costCenter']||'';
                    },
                    editor: function(container, options){

                        if (options.model.invoiceLineId != "") {
                            container.html(options.model.costCenter);
                            container.removeClass('k-edit-cell');
                        }else {
                            var editor = $('<input type="text" name="costCenter" class="k-input k-textbox">');
                            editor.css('width','100%');
                            container.append(editor);
                        }
                    }

                },{
                    field      : "profitCenter",
                    title      : "<@spring.message 'hpms.fin.invoice.profitCenter'/>",
                    width      : 120,
                    attributes  : {style: "text-align:center"},
                    template:function(dataItem) {
                        return dataItem['profitCenter']||'';
                    },
                    editor: function(container, options){

                        if (options.model.invoiceLineId != "") {
                            container.html(options.model.profitCenter);
                            container.removeClass('k-edit-cell');
                        }else {
                            var editor = $('<input type="text" name="profitCenter" class="k-input k-textbox">');
                            editor.css('width','100%');
                            container.append(editor);
                        }
                    }

                },{
                    field      : "lineAmount",
                    title      : "<@spring.message 'hpms.fin.invoice.lineAmount'/>",
                    width      : 100,
                    attributes  : {style: "text-align:center"},
                    template:function(dataItem) {
                        return dataItem['lineAmount']||'';
                    },
                    editor: function(container, options){

                        if (options.model.invoiceLineId != "") {
                            container.html(options.model.lineAmount);
                            container.removeClass('k-edit-cell');
                        }else {
                            var editor = $('<input type="text" name="lineAmount" class="k-input k-textbox">');
                            editor.css('width','100%');
                            container.append(editor);
                        }
                    }
                },{
                    field      : "taxCode",
                    title      : "<@spring.message 'hpms.fin.invoice.taxCode'/>",
                    width      : 100,
                    attributes  : {style: "text-align:center"},
                    template:function(dataItem) {
                        return dataItem['taxCode']||'';
                    },
                    editor: function(container, options){

                        if (options.model.invoiceLineId != "") {
                            container.html(options.model.taxCode);
                            container.removeClass('k-edit-cell');
                        }else {
                            var editor = $('<input type="text" name="taxCode" class="k-input k-textbox">');
                            editor.css('width','100%');
                            container.append(editor);
                        }
                    }
                },{
                    field      : "taxAmount",
                    title      : "<@spring.message 'hpms.fin.invoice.taxAmount'/>",
                    width      : 100,
                    attributes  : {style: "text-align:center"},
                    template:function(dataItem) {
                        return dataItem['taxAmount']||'';
                    },
                    editor: function(container, options){

                        if (options.model.invoiceLineId != "") {
                            container.html(options.model.taxAmount);
                            container.removeClass('k-edit-cell');
                        }else {
                            var editor = $('<input type="text" name="taxAmount" class="k-input k-textbox">');
                            editor.css('width','100%');
                            container.append(editor);
                        }
                    }
                },{
                    field      : "description",
                    title      : "备注",
                    width      : 120,
                    attributes  : {style: "text-align:center"},
                    template:function(dataItem) {
                        return dataItem['description']||'';
                    },
                    editor: function(container, options){

                        if (options.model.invoiceLineId != "") {
                            container.html(options.model.description);
                            container.removeClass('k-edit-cell');
                        }else {
                            var editor = $('<input type="text" name="description" class="k-input k-textbox">');
                            editor.css('width','100%');
                            container.append(editor);
                        }
                    }
                }],
                editable: false


            }).data("kendoGrid");
            $("#invoice_grid thead>tr th").css("text-align","center");
            Hap.autoResizeGrid("#invoice_grid");

        </script>
        </body>
        </html>