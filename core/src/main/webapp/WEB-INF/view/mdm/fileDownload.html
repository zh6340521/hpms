<#--
        * description: 工单附件查看
        * version: 1.0
        * author: chengye.hu@hand-china.com
        -->

        <body>


        <div class="panel-body">
            <div class="form-group">
                <div id='grid-container'>
                    <div id="taskOrderFileGrid"></div>
                </div>
            </div>
        </div>


        <script>
            window.viewModel = kendo.observable({


            });
            var sourceType='IMG2';

            var gridDataSource=new kendo.data.DataSource({
                transport:{
                    read: {
                        url: '${base.contextPath}/hpms/mdm/equipment/queryFiles?sourceType='+sourceType+'&sourceKey='+newViewModel.model.equipmentId+'',
                        type: "post",
                        dataType: "json"
                    },
                    destroy: {
                        url: '${base.contextPath}/sys/attach/file/remove',
                        contentType: "application/json",
                        type : "POST"
                    },
                    parameterMap: function (options, type) {

                        if (type !== "read" && options.models) {
                            return kendo.stringify(options.models);
                        }else if (type === "read") {
                            var map = {};
                            map.page = options.page;
                            map.pagesize = options.pageSize;
                            return map;
                        }
                    }
                },
                batch: true,
                serverPaging : true,
                pageSize: 10,
                schema: {
                    model:{id:'fileId'},
                    data:'rows',
                    total:'total'
                }
            });

            var grid= $("#taskOrderFileGrid").kendoGrid({
                dataSource: gridDataSource,
                navigatable: true,
                //height:'100%',
                resizable: true,
                sortable: true,
                scrollable: true,
                editable:false,
                selectable : 'multiple, rowbox',
                pageable: {
                    pageSizes:[5, 10, 20, 50],
                    refresh:true,
                    buttonCount:5
                },
                toolbar: [{
                    template:'<span  onclick="deleteData()"  class="btn btn-danger"><@spring.message "hap.delete"/></span>'
                }],
                columns: [
                    { field: "fileName", title: '<@spring.message "sysfile.filename"/>', width: 100 },
                    { field: "fileSize", title:'<@spring.message "sysfile.filesize"/>', width: 60 },
                    { field: "uploadDate", title:'<@spring.message "sysfile.uploaddate"/>', width: 80 },
                    { field: "fileType", title:'<@spring.message "sysfile.filetype"/>', width: 200 },
                    {
                        template:function(e){
                            return '<a href="${base.contextPath}/sys/attach/file/detail?fileId='+ e.fileId+'&token='+ e._token+'">下载</a>';
                        },width:50
                    } ]
            }).data("kendoGrid");


            function deleteData() {

                var checked = grid.selectedDataItems();
                if(grid.selectedDataItems().length){
                    kendo.ui.showConfirmDialog({
                        title:$l('hap.tip.info'),
                        message: $l('hap.tip.delete_confirm')
                    }).done(function (event) {
                        if (event.button == 'OK') {
                            $.each(checked,function(i,v){
                                grid.dataSource.remove(v)
                            })
                            grid.dataSource.sync();
                        }
                    })
                }

            }



            //grid屏幕自适应
           // Hap.autoResizeGrid("#taskOrderFileGrid");

        </script>
        </body>
        </html>