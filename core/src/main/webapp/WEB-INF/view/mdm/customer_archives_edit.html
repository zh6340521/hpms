<#-- * description: 客户档案新增页面 * version: 1.0 *
author:huifang.zhou@hand-china.com * --> 
<#include "../include/header.html">
<html>
<body>
<script
	src="${base.contextPath}/common/code?customerType=HPMS_MDM_CUSTOMER_TYPE"
	type="text/javascript"></script>
<script
	src="${base.contextPath}/common/code?credentialType=HPMS_MDM_CREDENTIAL_TYPE"
	type="text/javascript"></script>
<script
	src="${base.contextPath}/common/code?cusDocumentTypeData=HPMS_MDM_CUS_DOCUMENT_TYPE"
	type="text/javascript"></script>
<script
	src="${base.contextPath}/common/code?nationality=HPMS_MDM_PEOPLE_NATIONALITY"
	type="text/javascript"></script>
	<script
	src="${base.contextPath}/common/code?nation=HPMS_MDM_NATION"
	type="text/javascript"></script>
<script
	src="${base.contextPath}/common/code?relType=HPMS_MDM_RELATION_TYPE"
	type="text/javascript"></script>
<script
	src="${base.contextPath}/common/code?paymentCurrency=HPMS_MDM_PAYMENT_CURRENCY"
	type="text/javascript"></script>
<script
	src="${base.contextPath}/common/code?companyType=HPMS_MDM_COMPANY_TYPE"
	type="text/javascript"></script>
	

		<script type="text/javascript">
        var islook = '${RequestParameters.islook!0}' == '1';
        var isedit = '${RequestParameters.isedit!0}' == '1';
        var custBpId = '${RequestParameters.bpId!0}';
        var enableFlag = '${RequestParameters.enableFlag!0}';
			var viewModel = kendo.observable({
				model : {},
			})
			var viewModelPersonage = kendo.observable({
				model : {},
				resetForm : function(e) {
					var formData = viewModelPersonage.model.toJSON();
					for ( var k in formData) {
						viewModelPersonage.model.set(k, null);
					}
				}
			})
			
			var viewModelCompany = kendo.observable({
				model : {},
				resetForm : function(e) {
					var formData = viewModelCompany.model.toJSON();
					for ( var k in formData) {
						viewModelCompany.model.set(k, null);
					}
				}
			})
			var viewModelSales = kendo.observable({
				model : {},
				resetForm : function(e) {
					var formData = viewModelSales.model.toJSON();
					for ( var k in formData) {
						viewModelSales.model.set(k, null);
					}
				}
			})
			var viewModelPersonnel = kendo.observable({
			    model : {},
			    resetForm : function(e) {
					var formData = viewModelPersonnel.model.toJSON();
					for ( var k in formData) {
						viewModelPersonnel.model.set(k, null);
					}
				}
			})
			var  viewModelRelationship = kendo.observable({
			    model : {},
			    resetForm : function(e) {
					var formData = viewModelRelationship.model.toJSON();
					for ( var k in formData) {
						viewModelRelationship.model.set(k, null);
					}
				}
			})
			
			var viewModelbpGender = kendo.observable({
			     model : {},
			     queryResource: function (e) {
           		 $('#retaionGrid').data('kendoGrid').dataSource.page(1);
       	 		},
			})
			$(document).ready(function() {
				$("#tabstrip").kendoTabStrip({
					animation : {
						open : {
							effects : "fadeIn"
						}
					}
				});
			});
			
			kendo.bind($('#query-form'), viewModel);
		</script>
		
	<div id="newContact" style="display: none"></div>
    <div id="editRelation" style="display: none"></div>
	<div id="content-container">
		<div id="page-content">
			<div class="panel" style="padding: 0px; border: none; box-shadow: none;">
				<form class="form-horizontal" id="query-form" style="margin-top: 1px;">
					<div class="row" style="margin-bottom: 10px;">
						<div class="col-xs-6" >
								<label class="col-xs-4 control-label" style="text-align: right"><@spring.message "hpms.mdm.customer.customertype"/></label> 
								<div class="col-xs-8">
								<input id="customerType" name="customerType" style="width: 90%;" data-bind="text:model.meaning,value:model.customerType"  required validationMessage="<@spring.message 'hpms.notempty'/>"/>
								<span style="color: red">*</span>
								</div>
								<span class="k-invalid-msg" data-for="customerType"></span>
								<script>
									$("#customerType").kendoDropDownList({
									optionLabel : "<@spring.message "hpms.mdm.equipmenttype.select"/>",
														dataTextField : "meaning",
														dataValueField : "value",
														template : function(dataItem) {
															return dataItem['meaning']
																	|| ''
														},
														dataSource : customerType,
														select : function(e) {
															var dataItem = this.dataItem(e.item);
															viewModel.model.set('customerType',dataItem.value);
															var csType = viewModel.model.customerType;
															if ("PERSON" == csType) {
																company.style.display = "none";
																personage.style.display = "block";
																relation.style.display = "block";
																
															} else if ("COMPANY" == csType) {
																personage.style.display = "none";
																relation.style.display = "none";
																company.style.display = "block";
															}
														}
													}).data("kendoDropDownList");
													kendo.bind($('#customerType'), viewModel);
								</script>
						</div>

						<!-- 名称 -->
						<div class="col-xs-6" >
							<div class="pull-right">
								<label class="col-xs-4 control-label" style="text-align: right"><@spring.message "hpms.mdm.customer.customernumber"/></label> 
								<div class="col-xs-8">
								<input id="customerNumber" type="text" style="width: 90%;"
									data-bind="value:model.customerNumber" class="k-textbox" disabled>
									<script>kendo.bind($('#customerNumber'), viewModel);</script>
							</div>
							</div>
						</div>
					
						<div class="col-xs-6">
								<label class="col-xs-4 control-label"  style="text-align: right"><@spring.message "hpms.mdm.project.groupname"/></label> 
								<div class="col-xs-8">
								<input id="groupId" name="groupId" style="width: 90%;" data-bind="value:model.groupId" required validationMessage="<@spring.message 'hpms.notempty'/>">
								<span style="color: red">*</span>
								</div>
								<span class="k-invalid-msg" data-for="groupId"></span>
								<script>
									 $("#groupId").kendoComboBox({
		  									valuePrimitive: true,
											 dataTextField: "companyFullName",
     									     dataValueField: "companyId",
     									     dataSource: {
                   						 transport: {
                  				  	read:function(options) {
								      $.ajax({
						  		      type   : "POST",
						   		     url: "${base.contextPath}/mdm/property/groupQuery",
								        data: {}, 
						   		     success: function(json) {
						      		    options.success(json.rows);
						        }
						      });
    					}
                	} 
          }
		});
													kendo.bind($('#groupId'), viewModel);
								</script>
							</div>
							</div>
				</form>
			</div>
			
		</div>



		<!-- =================================== tab页 ============================================== -->
		<div id="tabstrip" style="padding: 1px;">
			<ul class="nav nav-tabs" id="mytab">
				<li id="bpGenerals" class="k-state-active"><a><@spring.message "hpms.mdm.tab.bpgeneral"/></a></li>
				<li id="sale" class="k-state-disabled"><a><@spring.message "hpms.mdm.tab.sales"/></a></li>
				<li id="relation" class="k-state-disabled"><a><@spring.message "hpms.mdm.tab.relation"/></a></li>
			</ul>

			<!-- =================================== 第一个tab页  ============================================== -->
			<div style="height: 100%; clear: both; padding-top: 12px;">
				<div id="general_information_grid">
					<div id="personage">
					<div class="row">
					<div class="col-xs-5">
									<label class="col-xs-2 control-label" style="text-align: right"><@spring.message "hpms.mdm.bpgeneral.name"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="fullName" name="fullName" style="width: 88%;" data-bind="value:model.fullName" class="k-textbox" required validationMessage="<@spring.message 'hpms.notempty'/>"/>
	                       			<span style="color:red;">*</span>
									</div>
                          			<span class="k-invalid-msg" data-for="fullName"></span>
					</div>
					<div class="col-xs-5">
									<label class="col-xs-2 control-label" style="text-align: right;margin-right: -10px;"><@spring.message "employee.gender"/>:</label>
								<div class="col-xs-6">
									<input id="sexID" name="sexID" type="radio" class="gender" value="男" data-bind="checked:model.personGender" style="width: 10%" />男 
									<input id="sexID" name="sexID" type="radio" class="gender" value="女" style="width: 10%" data-bind="checked:model.personGender" />女
									<input id="sexID" checked name="sexID" type="radio" class="gender" value="未知" style="width: 10%" data-bind="checked:model.personGender" />未知
								</div>
					</div>
					</div>
					<div class="row" style="margin: 11px;">
					<div class="col-xs-5" style="margin-left: -11px;">
									<label class="col-xs-3 control-label" style="margin-left: -17px;margin-right: -8px;"><@spring.message "employee.mobile"/>:</label> 
									<div class="col-xs-7">
									<input id="contactMobile"  type="text" data-bind="value:model.contactMobile" name="contactMobile" class="k-textbox" style="width: 93%;">
                                   <span style="color: red">*</span>
                                   </div>
									<script>
										document.getElementById('contactMobile').onblur=function(){
                        					var tt= /^1[0-9]{10}$/;
                        					if(tt.test(this.value)){
                        					//alert('正整数');
                        					}else{
                        					//alert('非正整数');
                        					var $parent = $("input[name='contactMobile']").parent();
                        					$parent.append('<span class="k-widget k-tooltip k-tooltip-validation k-invalid-msg" data-for="contactMobile" role="alert">'+'<span class="k-icon k-warning">'+'</span>'+"请输入有效的移动电话"+'</span>');
                        					viewModelPersonage.model.set('contactMobile',null);
                            }

                        }
									</script>
							</div>
							
							
							<div class="col-xs-5">
									<label class="col-xs-3 control-label" style="margin-right: -20px;"><@spring.message "hpms.mdm.bpgeneral.brith"/>:</label> 
									<div class="col-xs-7">
									<input type="date" style="width: 90%;" id="startTime" data-bind="value:model.personBirthday">
									</div>
									<script type="text/javascript">
										$("#startTime").kendoDatePicker({
											format : "yyyy-MM-dd"
										});
									</script>
						</div>
						</div>
						<div class="row" style="margin: 11px;">
							<div class="col-xs-5"  style="margin-left: -11px;">
									<label class="col-xs-3 control-label"  style="margin-left: -17px;margin-right: -8px;"><@spring.message "hpms.mdm.bpGeneral.credentialtype"/>:</label>
									<div class="col-xs-7">
									<input id="credentialType" name="credentialType" style="width: 93%;" data-bind="value:model.credentialType" />
									<span style="color: red">*</span>
									</div>
									<script>
										$("#credentialType").kendoDropDownList({
															valuePrimitive: true,
															optionLabel : "<@spring.message "hpms.mdm.equipmenttype.select"/>",
															dataTextField : "meaning",
															dataValueField : "value",
															dataSource : credentialType,
															select : function(e) {
																var dataItem = this.dataItem(e.item);
																viewModelPersonage.model.set('credentialType',dataItem.value);
															}
														}).data("kendoDropDownList");
									</script>
							</div>
							<div class="col-xs-5">
									<label class="col-xs-3 control-label" style="margin-right: -20px;"><@spring.message "hpms.mdm.bpGeneral.credentialnumber"/>:</label> 
									<div class="col-xs-7">
									<input id="credentialNumber" name="credentialNumber" type="text" style="width: 90%;" data-bind="value:model.credentialNumber" class="k-textbox">
									<span style="color: red">*</span>
									</div>
									<script>
										document.getElementById('credentialNumber').onblur=function(){
										var type = viewModelPersonage.model.credentialType;
										if(type == "IDENTIFICATION_CARDS"){
											var tt= /^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{4}$/;
                        					if(tt.test(this.value)){
                        					//alert('正整数');
                        					}else{
                        					//alert('非正整数');
                        					var $parent = $("input[name='credentialNumber']").parent();
                        					$parent.append('<span class="k-widget k-tooltip k-tooltip-validation k-invalid-msg" data-for="credentialNumber" role="alert">'+'<span class="k-icon k-warning">'+'</span>'+"证件号码不正确"+'</span>');
                        					viewModelPersonage.model.set('credentialNumber',null);
                            }
										}

                        }
									</script>
								</div>
						</div>
						
					<div class="row" style="margin: 11px;">
					<div class="col-xs-5"  style="margin-left: -11px;">
									<label class="col-xs-3 control-label" style="margin-left: -17px;margin-right: -8px;"><@spring.message "hpms.mdm.bpgeneral.contacttel"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="contactTel" style="width: 93%;" data-bind="value:model.contactTel" class="k-textbox"/>
									</div>
					</div>
					<div class="col-xs-5">
									<label class="col-xs-3 control-label" style="margin-right: -20px;"><@spring.message "hpms.mdm.bpgeneral.officetel"/>:</label>
								<div class="col-xs-7">
									<input type="text" id="contactTel" style="width: 90%;" data-bind="value:model.contactTel" class="k-textbox"/>
									</div>
					</div>
					</div>
					<div class="row" style="margin: 11px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.mdm.bpgeneral.country"/>:</label> 
									<div class="col-xs-7">
									<input id="country" name="country" style="width: 93%;" data-bind="value:model.country"/>
									</div>
									<script>
										$("#country").kendoDropDownList({
															optionLabel : "<@spring.message "hpms.mdm.equipmenttype.select"/>",
															valuePrimitive: true,
															dataTextField : "meaning",
															dataValueField : "value",
															template : function(dataItem) {
																return dataItem['meaning']
																		|| ''
															},
															dataSource : nationality,
															select : function(e) {
																var dataItem = this.dataItem(e.item);
																viewModelPersonage.model.set('country',dataItem.value);
																var type = viewModelPersonage.model.country;
																console.log(type)
																if("CHINA" == type){
																	$("#nation").data("kendoDropDownList").enable(true);
																}else{
																	$("#nation").data("kendoDropDownList").enable(false);
																}
															}
														}).data("kendoDropDownList");
									</script>
					</div>
					<div class="col-xs-5" style="margin-left: 19px;">
									<label class="col-xs-3 control-label" style="margin-right: -45px;"><@spring.message "hpms.mdm.bpgeneral.nation"/>:</label>
								<div class="col-xs-7">
									<input id="nation" name="nation" style="width: 90%;" data-bind="value:model.nation"/>
									</div>
									<script>
										$("#nation").kendoDropDownList({
															optionLabel : "<@spring.message "hpms.mdm.equipmenttype.select"/>",
															valuePrimitive: true,
															dataTextField : "meaning",
															dataValueField : "value",
															template : function(dataItem) {
																return dataItem['meaning']
																		|| ''
															},
															dataSource : nation,
															select : function(e) {
																var dataItem = this.dataItem(e.item);
																viewModelPersonage.model.set('nation',dataItem.value);
															},
															dataBound:function(){
																$("#nation").data("kendoDropDownList").enable(false);
          													}
														}).data("kendoDropDownList");
										
									</script>
					</div>
					</div>
					<div class="row" style="margin: 11px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.mdm.bpgeneral.placeOfOrigin"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="placeOfOrigin" style="width: 93%;" data-bind="value:model.placeOfOrigin" class="k-textbox"/>
									</div>
					</div>
					<div class="col-xs-5" style="margin-left: -17px;">
									<label class="col-xs-4 control-label" style="margin-right: -30px;"><@spring.message "hpms.mdm.bpgeneral.residenza"/>:</label>
								<div class="col-xs-6">
									<input type="text" id="residenza" style="width: 105%;" data-bind="value:model.residenza" class="k-textbox"/>
									</div>
					</div>
					</div>
					<div class="row" style="margin: 11px;">
					<div class="col-xs-5"  style="margin-left: -11px;">
									<label class="col-xs-3 control-label" style="margin-left: -17px;margin-right: -8px;"><@spring.message "hpms.mdm.bpgeneral.contactEmail"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="contactEmail" style="width: 93%;" data-bind="value:model.contactEmail" class="k-textbox"/>
									</div>
					</div>
					<div class="col-xs-5" style="margin-left: 25px;">
									<label class="col-xs-3 control-label" style="margin-right: -46px;"><@spring.message "company.fax"/>:</label>
								<div class="col-xs-7">
									<input type="text" id="fax" style="width: 90%;" data-bind="value:model.fax" class="k-textbox"/>
									</div>
					</div>
					</div>
						<div class="pull-right" id="toolbar-Personage" style="padding-bottom: 3px;margin-right: 110px;">
							<span class="btn btn-success" id="savePersonage" type="submit" onclick="submitPersonage()"><i class="fa fa-save" style="margin-right: 10px;"></i><@spring.message "hap.save"/></span>
                            <span class="btn btn-success" id="cancel" type="button" data-bind="click:resetForm"><i class="fa fa-times-circle-o" style="margin-right: 3px;"></i><@spring.message "hap.cancel"/></span>
                            <span type="submit" id="editPersonage" class="btn btn-primary" onclick="editPersonage()" style="margin-right: 10px;display: none;"><@spring.message "hap.edit"/></span>
							<span class="btn btn-success" id="updatePersonage" type="submit" onclick="updatePersonage()" style="display: none;"><i class="fa fa-save" style="margin-right: 10px;"></i><@spring.message "hap.save"/></span>
						</div>
					</div>
					<script>
									kendo.bind($('#personage'),viewModelPersonage);
					</script>
					<!--客户类型选择公司的第一个tab页 -->
					<div id="company" style="display: none;">
					<div class="row" style="margin: 32px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.mdm.bpgeneral.companyname"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="companyName" style="width: 90%;" data-bind="value:model.companyName" class="k-textbox" required validationMessage="<@spring.message 'hpms.notempty'/>"/>
									<span style="color: red">*</span>
									</div>
									<span class="k-invalid-msg" data-for="companyName"></span>
					</div>
					<div class="col-xs-5" style="margin-left: 35px;">
									<label class="col-xs-3 control-label" style="margin-right: -23px;text-align: right;"><@spring.message "hpms.mdm.bpgeneral.companyType"/>:</label>
								<div class="col-xs-7">
									<input type="text" id="companyType" name="companyType" style="width: 90%;" data-bind="value:model.companyType"  required validationMessage="<@spring.message 'hpms.notempty'/>"/>
									<span style="color: red">*</span>
									</div>
									<span class="k-invalid-msg" data-for="companyType"></span>
									<script>
										$("#companyType").kendoDropDownList({
															valuePrimitive: true,
															optionLabel : "<@spring.message "hpms.mdm.equipmenttype.select"/>",
															dataTextField : "meaning",
															dataValueField : "value",
															template : function(
																	dataItem) {
																return dataItem['meaning']
																		|| ''
															},
															dataSource : companyType,
															select : function(e) {
																var dataItem = this.dataItem(e.item);
																viewModelCompany.model.set('companyType',dataItem.value);
															}
														}).data("kendoDropDownList");
									</script>
					</div>
					</div>
					
					<div class="row" style="margin: 32px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.mdm.bpgeneral.contacttel"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="Tel" name="Tel" style="width: 90%;" data-bind="value:model.contactTel" class="k-textbox" required validationMessage="<@spring.message 'hpms.notempty'/>"/>
									<span style="color: red">*</span>
									</div>
									<span class="k-invalid-msg" data-for="Tel"></span>
					</div>
					<div class="col-xs-5" style="margin-left: 35px;">
									<label class="col-xs-3 control-label" style="margin-right: -23px;"><@spring.message "employee.mobile"/>:</label>
								<div class="col-xs-7">
									<input type="text" id="contactMo" name="contactMo" style="width: 90%;" data-bind="value:model.contactMobile" class="k-textbox" />
									</div>
									<script>
										document.getElementById('contactMo').onblur=function(){
                        					var tt= /^1[0-9]{10}$/;
                        					if(tt.test(this.value)){
                        					//alert('正整数');
                        					}else{
                        					//alert('非正整数');
                        					var $parent = $("input[name='contactMo']").parent();
                        					$parent.append('<span class="k-widget k-tooltip k-tooltip-validation k-invalid-msg" data-for="contactMo" role="alert">'+'<span class="k-icon k-warning">'+'</span>'+"请输入有效的移动电话"+'</span>');
                        					viewModelCompany.model.set('contactMobile',null);
                            }

                        }
									</script>
					</div>
					</div>
					<div class="row" style="margin: 32px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.mdm.bpGeneral.credentialtype"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="cusDocumentType" name="cusDocumentType" style="width: 90%;" data-bind="value:model.credentialType" required validationMessage="<@spring.message 'hpms.notempty'/>"/>
									<span style="color: red">*</span>
									</div>
									<span class="k-invalid-msg" data-for="cusDocumentType"></span>
									<script>
										$("#cusDocumentType").kendoDropDownList({
															optionLabel : "<@spring.message "hpms.mdm.equipmenttype.select"/>",
															valuePrimitive: true,
															dataTextField : "meaning",
															dataValueField : "value",
															template : function(dataItem) {
																return dataItem['meaning']
																		|| ''
															},
															dataSource : cusDocumentTypeData,
															select : function(e) {
																var dataItem = this.dataItem(e.item);
																viewModelCompany.model.set('credentialType',dataItem.value);
															}
														}).data("kendoDropDownList");
									</script>
					</div>
					<div class="col-xs-5" style="margin-left: 35px;">
									<label class="col-xs-3 control-label" style="margin-right: -23px;text-align: right;"><@spring.message "hpms.mdm.bpGeneral.credentialnumber"/>:</label>
								<div class="col-xs-7">
									<input type="text" id="credNumber" name="credNumber" style="width: 90%;" data-bind="value:model.credentialNumber" class="k-textbox"  required validationMessage="<@spring.message 'hpms.notempty'/>"/>
										<span style="color: red">*</span>
								</div>
								<span class="k-invalid-msg" data-for="credNumber"></span>
								
					</div>
					</div>
					<div class="row" style="margin: 32px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.mdm.bpGeneral.contactEmail"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="Email" style="width: 90%;" data-bind="value:model.contactEmail" class="k-textbox"/>
									</div>
					</div>
					<div class="col-xs-5" style="margin-left: 35px;">
									<label class="col-xs-3 control-label" style="margin-right: -23px;text-align: right;"><@spring.message "company.fax"/>:</label>
								<div class="col-xs-7">
									<input type="text" id="faxs" style="width: 90%;" data-bind="value:model.fax"  class="k-textbox"/>
									</div>
					</div>
					</div>
						<div class="pull-right" id="toolbar-btn" style="padding-bottom: 32px;margin-right: 78px;">
							<span class="btn btn-success" id="saveCompany" type="submit" onclick="submitCompany()"><i class="fa fa-save" style="margin-right: 10px;"></i><@spring.message "hap.save"/></span>
                            <span class="btn btn-success" id="resetCompany" type="button" data-bind="click:resetForm"><i class="fa fa-times-circle-o" style="margin-right: 3px;"></i><@spring.message "hap.cancel"/></span>
							<span type="submit" id="editCompany" class="btn btn-primary" onclick="editCompany()" style="margin-right: 10px;display: none;"><@spring.message "hap.edit"/></span>
							<span class="btn btn-success" id="updateCompany" type="submit" onclick="updateCompany()" style="display: none;"><i class="fa fa-save" style="margin-right: 10px;"></i><@spring.message "hap.save"/></span>
						</div>
					</div>
					<script>
									kendo.bind($('#company'),viewModelCompany);
					</script>
				</div>
			</div>
			<!-- =================================== 第二个tab页  ============================================== -->
			<div style="height: 100%; clear: both; padding-top: 20px;">
				<div id="sales_information_grid">
				<div id="sales" >
					<div class="row" style="margin: 32px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.mdm.project.companyname"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="companyId" name="companyId" style="width: 90%;" data-bind="value:model.companyId" required validationMessage="<@spring.message 'hpms.notempty'/>"/>
									<span style="color: red">*</span>
									</div>
									<span class="k-invalid-msg" data-for="companyId"></span>
									<script>
									$("#companyId").kendoComboBox(
													{
														autoBind : false,
														valuePrimitive : true,
														cascadeFrom : "groupId",

														cascadeFromField : "companyId",
														filter : "contains",
														dataTextField : "companyFullName",
														dataValueField : "companyId",
														dataSource : {
															serverFiltering : true,
															transport : {
																read : {
																	url : "/core/hpms/mdm/project/companyQuery",
																	type : "POST"
																},
																contentType : "application/json",
																parameterMap : function(options,type) {
																	if (type === "read") {
																		var filter = options.filter.filters[0]
																		var map = {};
																		map[filter.field] = filter.value;
																		return map;
																	}
																}
															},
															schema : {
																data : 'rows'
															}
														}
													});
								</script>
					</div>
					<div class="col-xs-5" style="margin-left: 35px;">
									<label class="col-xs-3 control-label" style="margin-right: -23px;text-align: right;"><@spring.message "hpms.mdm.sales.deptlevel"/>:</label>
								<div class="col-xs-7">
									<input type="text" style="width: 90%;" data-bind="value:model.deptLevel"  class="k-textbox"/>
								</div>
								
					</div>
					</div>
					<div class="row" style="margin: 32px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.mdm.sales.receivableAccount"/>:</label> 
									<div class="col-xs-7">
									<input type="text" style="width: 90%;" data-bind="value:model.receivableAccount" class="k-textbox"/>
									</div>
					</div>
					<div class="col-xs-5" style="margin-left: 35px;">
									<label class="col-xs-3 control-label" style="margin-right: -23px;text-align: right;"><@spring.message "hpms.fin.invoice.taxcode"/>:</label>
								<div class="col-xs-7">
									<input type="text" style="width: 90%;" data-bind="value:model.taxCode"  class="k-textbox"/>
									</div>
					</div>
					</div>
					<div class="row" style="margin: 32px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.fin.invoice.paymentterm"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="paymentTermId" style="width: 90%;" data-bind="value:model.paymentTermId"/>
									</div>
									<script>
									    $("#paymentTermId").kendoComboBox({
		  									valuePrimitive: true,
										dataTextField: "paymentTermName",
										dataValueField: "paymentTermId",
										dataSource: {
 							            transport: {
 					                   	read:function(options) {
									    $.ajax({
								        type   : "POST",
								        url: "${base.contextPath}/mdm/paymentTerm/paymentTermQuery",
							        	data: {}, 
								        success: function(json) {
									          options.success(json.rows);
						              }
						         });
    					    }
                	    } 
                          }
		               });
									</script>
					</div>
					<div class="col-xs-5" style="margin-left: 35px;">
									<label class="col-xs-3 control-label" style="margin-right: -23px;text-align: right;"><@spring.message "hpms.mdm.invoice.paymentmethod"/>:</label>
								<div class="col-xs-7">
									<input type="text" id="paymentMethodId" style="width: 90%;" data-bind="value:model.paymentMethodId"/>
								</div>
								<script>
									    $("#paymentMethodId").kendoComboBox({
		  									valuePrimitive: true,
		  									dataTextField: "paymentMethodName",
          									dataValueField: "paymentMethodId",
          								    dataSource: {
                   							 transport: {
                    							read:function(options) {
						     						 $.ajax({
						        						type   : "POST",
						        						url: "${base.contextPath}/mdm/paymentMethod/paymentMethodQuery",
						       							data: {}, 
						        						success: function(json) {
						          						 options.success(json.rows);
						        }
						      });
    					}
                	} 
          }
		});
									</script>
								
					</div>
					</div>
					<div class="row" style="margin: 32px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.mdm.invoice.paymentCurrency"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="paymentCurrency" style="width: 90%;" data-bind="value:model.paymentCurrency"/>
									</div>
									<script>
										$("#paymentCurrency").kendoDropDownList({
															optionLabel : "<@spring.message "hpms.mdm.equipmenttype.select"/>",
															dataTextField : "meaning",
															dataValueField : "value",
															template : function(
																	dataItem) {
																return dataItem['meaning']
																		|| ''
															},
															dataSource : paymentCurrency,
															select : function(e) {
																var dataItem = this.dataItem(e.item);
																viewModelSales.model.set('paymentCurrency',dataItem.value);
															}
														}).data("kendoDropDownList");
									</script>
					</div>
					</div>
					<div class="pull-right" id="toolbar-btn"
						style="padding-bottom: 30px;margin-right: 73px;">
					<span class="btn btn-success" id="saveGrid" type="submit" onclick="saveSales()"><i class="fa fa-save" style="margin-right: 10px;"></i><@spring.message "hap.save"/></span>
                    <span class="btn btn-success" id="closeWin" type="button" data-bind="click:resetForm"><i class="fa fa-times-circle-o" style="margin-right: 3px;"></i><@spring.message "hap.cancel"/></span>
					</div>
					</div>
					<div id="salesFical" style="clear: both; display: none;">
						<div id="saleGrid"></div>
					</div>
				</div>
			</div>
			<script>kendo.bind($('#sales_information_grid'), viewModelSales);</script>
			<!-- =================================== 第三个tab页  ============================================== -->
			<div style="height: 100%; clear: both; padding-top: 20px;">
				<div id="personnel_relationship_grid">
				<div id="personnel">
				<div class="row"  style="margin: 32px;">
					<div class="col-xs-5"  style="margin-left: -6px;">
									<label class="col-xs-2 control-label" style="margin-right: -11px;"><@spring.message "hpms.mdm.bpgeneral.name"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="name" name="name" style="width: 88%;" data-bind="value:model.fullName" class="k-textbox" required validationMessage="<@spring.message 'hpms.notempty'/>"/>
	                       			<span style="color:red;">*</span>
									</div>
                          			<span class="k-invalid-msg" data-for="name"></span>
                          			<script>kendo.bind($('#name'), viewModelbpGender);</script>
					</div>
					<div class="col-xs-5"  style="margin-left: 16px;">
									<label class="col-xs-2 control-label" style="margin-right: -29px;margin-left: 43px;"><@spring.message "employee.gender"/>:</label>
								<div class="col-xs-6">
									<input id="sex" name="sex" type="radio" class="gender" value="男" data-bind="checked:model.personGender" style="width: 10%" />男 
									<input id="sex" name="sex" type="radio" class="gender" value="女" style="width: 10%" data-bind="checked:model.personGender" />女
									<input id="sex" checked name="sex" type="radio" class="gender" value="未知" style="width: 10%" data-bind="checked:model.personGender" />未知
								</div>
								<script>kendo.bind($('#sex'), viewModelbpGender);</script>
					</div>
					</div>
					<div class="row" style="margin: 32px;">
					
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "employee.mobile"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="tel" name="tel" style="width: 90%;" data-bind="value:model.contactMobile" class="k-textbox"/>
									<span style="color: red">*</span>
									</div>
									<script>
										document.getElementById('tel').onblur=function(){
                        					var tt= /^1[0-9]{10}$/;
                        					if(tt.test(this.value)){
                        					//alert('正整数');
                        					}else{
                        					//alert('非正整数');
                        					var $parent = $("input[name='tel']").parent();
                        					$parent.append('<span class="k-widget k-tooltip k-tooltip-validation k-invalid-msg" data-for="tel" role="alert">'+'<span class="k-icon k-warning">'+'</span>'+"请输入有效的移动电话"+'</span>');
                        					viewModelbpGender.model.set('contactMobile',null);
                            }

                        }
                        kendo.bind($('#tel'), viewModelbpGender);</script>
					</div>
					<div class="col-xs-5" style="margin-left: 35px;">
									<label class="col-xs-3 control-label" style="margin-right: -23px;"><@spring.message "hpms.mdm.bpGeneral.credentialtype"/>:</label>
								<div class="col-xs-7">
									<input type="text" id="credential" name="credential" style="width: 90%;" data-bind="text:model.meaning,value:model.credentialType" required validationMessage="<@spring.message 'hpms.notempty'/>"/>
									<span style="color: red">*</span>
									</div>
									<span class="k-invalid-msg" data-for="credential"></span>
									<script>
										$("#credential").kendoDropDownList({
															optionLabel : "<@spring.message "hpms.mdm.equipmenttype.select"/>",
															dataTextField : "meaning",
															dataValueField : "value",
															valuePrimitive: true,
															template : function(
																	dataItem) {
																return dataItem['meaning']
																		|| ''
															},
															dataSource : credentialType,
															select : function(e) {
																var dataItem = this.dataItem(e.item);
																viewModelbpGender.model.set('credentialType',dataItem.value);
															}
														}).data(
														"kendoDropDownList");
														kendo.bind($('#credential'), viewModelbpGender);
									</script>
					</div>
					</div>
					<div class="row" style="margin: 32px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-3 control-label" style="margin-left: -30px;text-align: right;"><@spring.message "hpms.mdm.bpGeneral.credentialnumber"/>:</label> 
									<div class="col-xs-7">
									<input type="text" id="crNumber" name="crNumber" style="width: 90%;" data-bind="value:model.credentialNumber" class="k-textbox"  required validationMessage="<@spring.message 'hpms.notempty'/>"/>
									<span style="color: red">*</span>
									</div>
									<span class="k-invalid-msg" data-for="crNumber"></span>
									<script>
										document.getElementById('crNumber').onblur=function(){
										var type = viewModelbpGender.model.credentialType;
										console.log(type)
										if(type == "IDENTIFICATION_CARDS"){
											var tt= /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
                        					if(tt.test(this.value)){
                        					//alert('正整数');
                        					}else{
                        					//alert('非正整数');
                        					var $parent = $("input[name='crNumber']").parent();
                        					$parent.append('<span class="k-widget k-tooltip k-tooltip-validation k-invalid-msg" data-for="crNumber" role="alert">'+'<span class="k-icon k-warning">'+'</span>'+"证件号码不正确"+'</span>');
                        					viewModelbpGender.model.set('crNumber',null);
                            }
										}

                        }
                        kendo.bind($('#crNumber'), viewModelbpGender);</script>
					</div>
					<div class="col-xs-5" style="margin-left: 35px;">
									<label class="col-xs-3 control-label" style="margin-right: -23px;"><@spring.message "hpms.mdm.relation.reltype"/>:</label>
								<div class="col-xs-7">
									<input type="text" id="relType" name="relType" style="width: 90%;" data-bind="text:model.meaning,value:model.relType"  required validationMessage="<@spring.message 'hpms.notempty'/>"/>
									<span style="color: red">*</span>
									</div>
									<span class="k-invalid-msg" data-for="relType"></span>
									<script>
										$("#relType").kendoDropDownList(
														{
															optionLabel : "<@spring.message "hpms.mdm.equipmenttype.select"/>",
															dataTextField : "meaning",
															dataValueField : "value",
															template : function(
																	dataItem) {
																return dataItem['meaning']
																		|| ''
															},
															dataSource : relType,
															select : function(e) {
																var dataItem = this
																		.dataItem(e.item);
																viewModelRelationship.model.set('relType',dataItem.value);
															}
														}).data(
														"kendoDropDownList");
										kendo.bind($('#relType'), viewModelRelationship);
									</script>
					</div>
					</div>
					<div class="row" style="margin: 32px;">
					<div class="col-xs-5" style="margin-left: -5px;">
									<label class="col-xs-4 control-label" style="margin-left: -51px;text-align: right;"><@spring.message "hpms.mdm.relation.icmflag"/>:</label> 
									<div class="col-xs-1">
									<input type="checkbox" id="icmFlag" style="width: 90%;" data-bind="value:model.icmFlag" class="k-textbox"/>
									</div>
									<script>
									 $("#icmFlag").kendoCheckbox({
                        					checkedValue:'1',
                							uncheckedValue:'0'
                        			});
									kendo.bind($('#icmFlag'), viewModelRelationship);</script>
					</div>
					</div>
					<div class="pull-right" id="toolbar-btn"
						style="padding-bottom: 32px;margin-right: 73px;">
					<span class="btn btn-success" id="saveGrid" type="submit" onclick="submitPersonnel()"><i class="fa fa-save" style="margin-right: 10px;"></i><@spring.message "hap.save"/></span>
                    <span class="btn btn-success" id="closeWin" type="button" onclick="close()"><i class="fa fa-times-circle-o" style="margin-right: 3px;"></i><@spring.message "hap.cancel"/></span>
					</div>
				</div>
			<div id="retaions" style="display: none;">
			<div class="pull-left" id="query" style="padding-bottom: 10px;">
				<label class="col-sm-4 control-label" style="margin-left: -15px;"><@spring.message "hpms.mdm.relation.name"/></label> 
				<input id="Name" type="text" style="width: 140px; margin-left: -15px;" data-bind="value:model.fullName" class="k-textbox" />
				<label class="col-sm-4 control-label"><@spring.message "employee.mobile"/></label> 
				<input id="phone" type="text" style="width: 140px; margin-left: -10px;" data-bind="value:model.contactMobile" class="k-textbox" />
			    <span class="btn btn-primary" data-bind="click:queryResource" style="width: 30px;margin-left: 4px;" type="submit"><i class="fa fa-search" style="margin-right:3px;"></i><@spring.message "hap.query"/></span>
			    <span type="submit" class="btn btn-primary" onclick="savePeople(custBpId)" id="savePeople"
								style="margin-left: 5px;"><@spring.message "hap.new"/><@spring.message "company.contactperson"/></span>
			    <div style="clear: both"></div>
		    </div>
		    <script>kendo.bind($('#query'), viewModelbpGender);</script>
		    <div style="clear: both">
		        <div id="retaionGrid"></div>
		    </div>
		    <script>kendo.bind($('#query'), viewModelbpGender);</script>
		    <div class="row" style="margin-bottom: 32px;"></div>
		    <div style="clear: both">
		        <div id="bpRetaionGrid"></div>
		    </div>
		    <script>kendo.bind($('#bpRetaionGrid'), viewModelRelationship);</script>
			</div>
			</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">
	$('#content-container').kendoValidator();
	$('#query').keydown(function (e) {
	    if (e.keyCode == 13) {
	        e.target.blur();
	        viewModelbpGender.queryResource(e);
	    }
	});
	 var crudServiceBaseUrl = '${base.contextPath}',
     dataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: crudServiceBaseUrl + "/hpms/mdm/SalesFinacial/queryByCustId?custId="+${RequestParameters.customerId!0},
                        type    : "POST",
                        dataType: "json"
                    },
                    update: {
                    url: crudServiceBaseUrl + "/hpms/mdm/SalesFinacial/salesFinacialSubmit",
                    contentType: "application/json",
                    type: "POST",
                },
                    parameterMap: function (options, type) {
                        if (type !== "read" && options.models) {
                            var datas = Hap.prepareSubmitParameter(options, type);
                            return kendo.stringify(datas);
                        } else if (type === "read") {
                            return Hap.prepareQueryParameter(viewModelSales.model.toJSON(), options);
                        }
                    }
                },batch: true,
                schema: {
                    data: 'rows',
                    total: 'total',
                    model: {
                        id: "salesFinacialId",
                        fields: {
 							meaning1:{type:"string"},
                        }
                    }
                }
            });
            
    var companyData = [];
	var paymentTermIdData = [];
	var paymentMethodData = [];
	//销售信息grid
	var saleGrid = $("#saleGrid").kendoGrid({
        dataSource: dataSource,
        navigatable: false,
		height: '100%',
		resizable: true,
		reorderable: true,
		sortable   : true, 
		selectable : "row",
	    editable: "inline",
		columnMenu: true,
        columns : [ 
        {command : [{name:"edit"}], 
	     title: '<@spring.message "hap.action"/>', 
		 attributes: {style: "text-align:center"},
		  width: 100
		},{
            field : "companyId",
	                title      : "<@spring.message 'hpms.mdm.property.company'/>", 
	                width      : 150,
	                attributes : {style: "text-align:center"},
	                template: function(dataItem){
	                
	                	if (companyData.length==0){
	                		return dataItem['companyFullName']|| '';
	                	}
	                	var v = dataItem.companyId;
	                    $.each(companyData,function(i,n){
	                        if (n.companyId==v){
	                        	v=n.companyFullName;
	                        }
	                    });
                    	return v || "";
	                
	                
					//	return dataItem['companyFullName']|| '' 
		           	},
		           	editor: function(container, options){
		           			$.ajax({
			    	      		url : '${base.contextPath}/mdm/property/companyQuery',
			    	      		type : 'POST',
			    	      		contentType : "application/json;charset=utf-8",
			    	      		cache : false,
			    	      		dataType : 'json',
			    	      		async : false,
			    	      		success : function(data) {
			    	      			companyData = data.rows
			    	      		}
			    	      	 }); 
				        	$('<input style="width: 50;" required validationMessage="<@spring.message "hpms.notempty"/>" name="' + options.field + '"/>')
		                         .appendTo(container).kendoDropDownList({
		                             dataTextField: "companyFullName",
		                             dataValueField: "companyId",
		                             valuePrimitive: true,
		                             dataSource: companyData,
		                             select:function(e){
			                        	 $.ajax({
						    	      		url : '${base.contextPath}/mdm/property/groupQuery?companyId='+options.model.companyId,
						    	      		type : 'POST',
						    	      		contentType : "application/json;charset=utf-8",
						    	      		cache : false,
						    	      		dataType : 'json',
						    	      		async : false,
						    	      		schema : {
																data : 'rows'
															}
			    	      	 			});
		                             }
		                    });
		            }
            },
            {
                field: "deptLevel",
                title: '<@spring.message "hpms.mdm.sales.deptLevel"/>',
                width: 120
            },
            {
                field: "receivableAccount",
                title: '<@spring.message "hpms.mdm.sales.receivableaccount"/>',
                width: 120
            },
            {
                field: "taxCode",
                title: '<@spring.message "hpms.fin.invoice.taxcode"/>',
                width: 120
            },
            {
                field: "paymentTermId",
                title: '<@spring.message "hpms.fin.invoice.paymentterm"/>',
                attributes: {style: "text-align:center"},
                width: 120,
                template: function(dataItem){
	                	if (paymentTermIdData.length==0){
	                		return dataItem['paymentTermName']|| '';
	                	}
	                	var v = dataItem.paymentTermId;
	                    $.each(paymentTermIdData,function(i,n){
	                        if (n.paymentTermId==v){
	                        	v=n.paymentTermName;
	                        }
	                    });
                    	return v || "";
	                
	                
					//	return dataItem['companyFullName']|| '' 
		           	},
		           	editor: function(container, options){
		           			$.ajax({
			    	      		url : '${base.contextPath}/mdm/paymentTerm/paymentTermQuery',
			    	      		type : 'POST',
			    	      		contentType : "application/json;charset=utf-8",
			    	      		cache : false,
			    	      		dataType : 'json',
			    	      		async : false,
			    	      		success : function(data) {
			    	      			paymentTermIdData = data.rows
			    	      		}
			    	      	 }); 
			    	    $('<input style="width: 50;" required validationMessage="<@spring.message "hpms.notempty"/>" name="' + options.field + '"/>')
		                         .appendTo(container).kendoDropDownList({
		                             dataTextField: "paymentTermName",
		                             dataValueField: "paymentTermId",
		                             valuePrimitive: true,
		                             dataSource: paymentTermIdData,
		                             select:function(e){
			                        	 $.ajax({
						    	      		url : '${base.contextPath}/mdm/paymentTerm/paymentTermQuery?paymentTermId='+options.model.paymentTermId,
						    	      		type : 'POST',
						    	      		contentType : "application/json;charset=utf-8",
						    	      		cache : false,
						    	      		dataType : 'json',
						    	      		async : false,
						    	      		schema : {
																data : 'rows'
															}
			    	      	 			});
		                             }
		                    });
		            }
            },
            {
                field: "paymentMethodId",
                title: '<@spring.message "hpms.mdm.invoice.paymentmethod"/>',
                attributes: {style: "text-align:center"},
                width: 120,
                template: function(dataItem){
	                	if (paymentMethodData.length==0){
	                		return dataItem['paymentMethodName']|| '';
	                	}
	                	var v = dataItem.paymentMethodId;
	                    $.each(paymentMethodData,function(i,n){
	                        if (n.paymentMethodId==v){
	                        	v=n.paymentMethodName;
	                        }
	                    });
                    	return v || "";
	                
	                
					//	return dataItem['companyFullName']|| '' 
		           	},
		           	editor: function(container, options){
		           			$.ajax({
			    	      		url : '${base.contextPath}/mdm/paymentMethod/paymentMethodQuery',
			    	      		type : 'POST',
			    	      		contentType : "application/json;charset=utf-8",
			    	      		cache : false,
			    	      		dataType : 'json',
			    	      		async : false,
			    	      		success : function(data) {
			    	      			paymentMethodData = data.rows
			    	      		}
			    	      	 }); 
			    	    $('<input style="width: 50;" required validationMessage="<@spring.message "hpms.notempty"/>" name="' + options.field + '"/>')
		                         .appendTo(container).kendoDropDownList({
		                             dataTextField: "paymentMethodName",
		                             dataValueField: "paymentMethodId",
		                             valuePrimitive: true,
		                             dataSource: paymentMethodData,
		                             select:function(e){
			                        	 $.ajax({
						    	      		url : '${base.contextPath}/mdm/paymentMethod/paymentMethodQuery?paymentMethodId='+options.model.paymentMethodId,
						    	      		type : 'POST',
						    	      		contentType : "application/json;charset=utf-8",
						    	      		cache : false,
						    	      		dataType : 'json',
						    	      		async : false,
						    	      		schema : {
																data : 'rows'
															}
			    	      	 			});
		                             }
		                    });
		            }
					//	return dataItem['companyFullName']|| '' 
            },
            {
                field: "paymentCurrency",
                title: '<@spring.message "hpms.mdm.invoice.paymentCurrency"/>',
                attributes: {style: "text-align:center"},
                width: 120,
                template:function (dataItem) {
                    var v = dataItem.paymentCurrency;
                    $.each(paymentCurrency,function(i,n){
                        if((n.value||'').toLowerCase() == (v||'').toLowerCase()){
                            v = n.meaning;
                            return v;
                        }
                    });
                    return v || "";
                },
                editor:function (container, options) {
                    $('<input required style="width: 90%;" ' +
                        ' validationMessage="<@spring.message "hap.error.nullexception"/>" ' +
                        'name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            dataTextField:"meaning",
                            dataValueField:"value",
                            valuePrimitive:true,
                            dataSource: paymentCurrency
                        });
                }
            }
        ]
    }).data("kendoGrid");
    
    var crudServiceBaseUrl = '${base.contextPath}',
     FicalsdataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: crudServiceBaseUrl + "/hpms/mdm/BpGeneral/queryBpGeneral",
                        type    : "POST",
                        dataType: "json"
                    },
                    parameterMap: function (options, type) {
                        if (type !== "read" && options.models) {
                            var datas = Hap.prepareSubmitParameter(options, type);
                            return kendo.stringify(datas);
                        } else if (type === "read") {
                            return Hap.prepareQueryParameter(viewModelbpGender.model.toJSON(), options);
                        }
                    }
                },batch: true,
                serverPaging: true,
                schema: {
                    data: 'rows',
                    total: 'total',
                    model: {
                        id: "relationId",
                        fields: {
 							meaning:{type:"string"}
                        }
                    }
                }
            });
    //一般信息表
    var retaionGrid = $("#retaionGrid").kendoGrid({
        dataSource: FicalsdataSource,
        navigatable: false,
        height: '100%',
        autoBind:false,
        resizable: true,
        scrollable: true,
        columns : [
	       		{
                field      : "操作",
                name:"edit",
                width      : 50 ,
                template : function(rowdata) {
                    var uid = rowdata.uid.toString();
                    var singleRecycle = '<button type="button" id="recyclecle" class="btn btn-warning btn-xs" data-toggle="tooltip" data-placement="top" title='+'<@spring.message "hap.edit"/>'+' onclick="updateReation('+rowdata.bpId+',\''+ custBpId+ '\')"><span class="glyphicon glyphicon-edit"></span></button>';
                    return singleRecycle;
                },
                attributes  : {style: "text-align:center"}
            },
            {
            
                field: "fullName",
                title: '<@spring.message "hpms.mdm.customer.customername"/>',
                width: 120
            },
            {
                field: "contactMobile",
                title: '<@spring.message "employee.mobile"/>',
                width: 120
            },
            {
                field: "meaning",
                title: '<@spring.message "hpms.mdm.bpGeneral.credentialtype"/>',
                width: 120
            },
            {
                field: "credentialNumber",
                title: '<@spring.message "hpms.mdm.bpGeneral.credentialnumber"/>',
                width: 120
            }
        ]
    }).data("kendoGrid");
    
    
    
    
    
    var crudServiceBaseUrl = '${base.contextPath}',
     ReationdataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: crudServiceBaseUrl + "/hpms/mdm/BpGeneral/queryByReation?fromBpId="+custBpId,
                        type    : "POST",
                        dataType: "json"
                    },
                    parameterMap: function (options, type) {
                        if (type !== "read" && options.models) {
                            var datas = Hap.prepareSubmitParameter(options, type);
                            return kendo.stringify(datas);
                        } else if (type === "read") {
                            var p = Hap.prepareQueryParameter("", options);
                        	p.bpId = custBpId;
                        	return p;
                        }
                    }
                },
                batch: true,
                pageSize: 5,
                schema: {
                    data: 'rows',
                    total: 'total',
                    model: {
                        id: "relationId",
                        fields: {
 							meaning:{type:"string"},
 							meaning4:{type:"string"},
 							icmFlag: {defaultValue: '1',type: 'boolean',checkedValue:'1',uncheckedValue:'0'}
                        }
                    }
                }
            });
    //人员关系grid
    var bpRetaionGrid = $("#bpRetaionGrid").kendoGrid({
        dataSource: ReationdataSource,
        navigatable: false,
        height: '100%',
        resizable: true,
        scrollable: true,
        pageable: {
            pageSizes: [5, 10, 20, 50],
            refresh: true,
            buttonCount: 5
        },
        columns: [
            {
                field      : "操作",
                name:"edit",
                width      : 50 ,
                template : function(rowdata) {
                    var uid = rowdata.uid.toString();
                    var singleRecycle = '<button type="button" id="recycle" class="btn btn-warning btn-xs" data-toggle="tooltip" data-placement="top" title='+'<@spring.message "hap.edit"/>'+' onclick="updateCantact('+custBpId+',\''+ rowdata.bpId+ '\')"><span class="glyphicon glyphicon-edit"></span></button>';
                    return singleRecycle;
                },
                attributes  : {style: "text-align:center"}
            },
            {
                field: "fullName",
                title: "<@spring.message "company.contactperson"/>",
                width: 120
            },
            {
                field: "contactMobile",
                title: '<@spring.message "employee.mobile"/>',
                width: 120
            },
            {
                field: "meaning",
                title: '<@spring.message "hpms.mdm.bpGeneral.credentialtype"/>',
                width: 120
            },
            {
                field: "credentialNumber",
                title: '<@spring.message "hpms.mdm.bpGeneral.credentialnumber"/>',
                width: 120
            },
            {
                field: "meaning4",
                title: '<@spring.message "hpms.mdm.relation.reltype"/>',
                width: 120
            },
            {
                field: "icmFlag",
                title: '<@spring.message "hpms.mdm.relation.icmFlag"/>',
                width: 120,
                attributes: {style: "text-align:center"}
            }
        ]
    }).data("kendoGrid");
		  
          var customerId;
          var bpId;
    			    //选择客户类型为个人的一般信息的保存
				function submitPersonage() {
					if(viewModel.model.groupId==''||viewModel.model.groupId==null){
            				kendo.ui.showInfoDialog({
                				message:'<@spring.message "hpms.mdm.project.groupname"/><@spring.message "hpms.mdm.notnull"/>'
           				 })
        			}else if(viewModelPersonage.model.fullName==''||viewModelPersonage.model.fullName==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.name"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelPersonage.model.contactMobile==''||viewModelPersonage.model.contactMobile==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "employee.mobile"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelPersonage.model.credentialType==''||viewModelPersonage.model.credentialType==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.credentialtype"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelPersonage.model.credentialNumber==''||viewModelPersonage.model.credentialNumber==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.credentialnumber"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else {
							var CustomerType = viewModel.model.customerType;
							var modelzilei = kendo.stringify(viewModelPersonage.model);
							
							var modelvalue = kendo.stringify(viewModel.model);
							var json = JSON.parse(modelvalue); 
							var jsonzilei = JSON.parse(modelzilei);
							json.bpGeneral = jsonzilei;
							viewModelPersonage.model.__status = 'add';
							$.ajax({ 
    							url: "${base.contextPath}/hpms/mdm/BpGeneral/submit",
    							type:"POST",
    							dataType:"json",
    							contentType:"application/json",
    							data:  kendo.stringify(json),
    				 			success: function(data){
												window.parent.$('#grid').data('kendoGrid').dataSource.page(1);
											if (data.success) {
												kendo.ui.showInfoDialog({
													message : '<@spring.message "hap.tip.success"/>'
												});
												enableTabTrue();
												enablePlanTrip();
												lookPersonage();
												viewModel.set("customerNumber",data.rows[0].customerNumber);
												customerId = data.rows[0].customerId;
												bpId = data.rows[0].bpId;
											} else {
												kendo.ui.showInfoDialog({
													message : '失败!'
												});
											}
      						}});
						 }
						};
						
						
						//选择客户类型为公司的一般信息的保存
			function submitCompany() {
					if(viewModel.model.customerType==''||viewModel.model.customerType==null){
            				kendo.ui.showInfoDialog({
                				message:'<@spring.message "hpms.mdm.customer.customertype"/><@spring.message "hpms.mdm.notnull"/>'
           				 })
        			}else if(viewModel.model.groupId==''||viewModel.model.groupId==null){
            				kendo.ui.showInfoDialog({
                				message:'<@spring.message "hpms.mdm.project.groupname"/><@spring.message "hpms.mdm.notnull"/>'
           				 })
        			}else if(viewModelCompany.model.companyName==''||viewModelCompany.model.companyName==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpGeneral.companyName"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelCompany.model.companyType==''||viewModelCompany.model.companyType==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpGeneral.companyType"/><@spring.message "hpms.mdm.notnull"/>'
            				})
            		}else if(viewModelCompany.model.contactTel==''||viewModelCompany.model.contactTel==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.contacttel"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelCompany.model.credentialType==''||viewModelCompany.model.credentialType==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.credentialtype"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelCompany.model.credentialNumber==''||viewModelCompany.model.credentialNumber==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.credentialnumber"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else {
							var CustomerType = viewModel.model.customerType;
							var CustomerNumber = viewModel.model.customerNumber;
							
							
							var modelzilei = kendo.stringify(viewModelCompany.model);
							var modelvalue = kendo.stringify(viewModel.model);
							var json = JSON.parse(modelvalue); 
							var jsonzilei = JSON.parse(modelzilei);
							json.bpGeneral = jsonzilei;
							viewModelPersonage.model.__status = 'add';
							$.ajax({ 
    							url: "${base.contextPath}/hpms/mdm/BpGeneral/submit",
    							type:"POST",
    							dataType:"json",
    							contentType:"application/json",
    							data:  kendo.stringify(json),
    				 			success: function(comData){
											 if (comData.success) {
												kendo.ui.showInfoDialog({
													message : '<@spring.message "hap.tip.success"/>'
												}); 
												window.parent.$('#grid').data('kendoGrid').dataSource.page(1);
												customerId = comData.rows[0].customerId;
												viewModel.set("customerNumber",data.rows[0].customerNumber);
												enableTabTrue();
												enablePlanTrip();
												lookCompany();
											} else {
												kendo.ui.showInfoDialog({
													message : '失败!'
												});
											}
      						}});
      						}
						};
						
						
						//选择客户类型为个人的人员关系的保存
					function submitPersonnel() {
						if(viewModelbpGender.model.fullName==''||viewModelbpGender.model.fullName==null){
            				kendo.ui.showInfoDialog({
                				message:'<@spring.message "hpms.mdm.bpgeneral.name"/><@spring.message "hpms.mdm.notnull"/>'
           				 })
        			}else if(viewModelbpGender.model.contactMobile==''||viewModelbpGender.model.contactMobile==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "employee.mobile"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelbpGender.model.credentialType==''||viewModelbpGender.model.credentialType==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpGeneral.credentialtype"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelbpGender.model.credentialNumber==''||viewModelbpGender.model.credentialNumber==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.credentialnumber"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelRelationship.model.relType==''||viewModelRelationship.model.relType==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.relation.reltype"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else {
							viewModelRelationship.model.set("fromBpId",bpId);
							var modelzilei = kendo.stringify(viewModelbpGender.model);
							var modelvalue = kendo.stringify(viewModelRelationship.model);
							var json = JSON.parse(modelvalue); 
							var jsonzilei = JSON.parse(modelzilei);
							json.bpGeneral = jsonzilei;
							viewModelRelationship.model.__status = 'add';
							$.ajax({ 
    							url: "${base.contextPath}/hpms/mdm/Relation/submit",
    							type:"POST",
    							dataType:"json",
    							contentType:"application/json",
    							data:  kendo.stringify(json),
    				 			success: function(data){
											if (data.success) {
												kendo.ui.showInfoDialog({
													message : '<@spring.message "hap.tip.success"/>'
												});
											} else {
												kendo.ui.showInfoDialog({
													message : data.message
												});
											}
      						}});
      						}
						}; 
			//销售财务保存
		   function saveSales() {
		   		if(viewModelSales.model.companyId==''||viewModelSales.model.companyId==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.project.companyname"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       			}else {
		         viewModelSales.model.set("custId",customerId);
		         var modelvalue = kendo.stringify(viewModelSales.model);
                 var json = JSON.parse(modelvalue); 
                 viewModelSales.model.__status = 'add';
            $.ajax({ 
    							url: "${base.contextPath}/hpms/mdm/BpGeneral/submitSales",
    							type:"POST",
    							dataType:"json",
    							contentType:"application/json",
    							data:  kendo.stringify(json),
    				 			success: function(data){
											if (data.success) {
												kendo.ui.showInfoDialog({
													message : '<@spring.message "hap.tip.success"/>'
												});
											} else {
												kendo.ui.showInfoDialog({
													message : '失败!'
												});
											}
      						}});
      						}
                   };
                   
            //选择公司时的一般信息from的修改       
            function updateCompany(){
            		if(viewModel.model.groupId==''||viewModel.model.groupId==null){
            				kendo.ui.showInfoDialog({
                				message:'<@spring.message "hpms.mdm.project.groupname"/><@spring.message "hpms.mdm.notnull"/>'
           				 })
        			}else if(viewModelCompany.model.companyName==''||viewModelCompany.model.companyName==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpGeneral.companyName"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelCompany.model.companyType==''||viewModelCompany.model.companyType==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpGeneral.companyType"/><@spring.message "hpms.mdm.notnull"/>'
            				})
            		}else if(viewModelCompany.model.contactTel==''||viewModelCompany.model.contactTel==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.contacttel"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelCompany.model.credentialType==''||viewModelCompany.model.credentialType==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.credentialtype"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelCompany.model.credentialNumber==''||viewModelCompany.model.credentialNumber==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.credentialnumber"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else {
               		var modelvalue = kendo.stringify(viewModelCompany.model);
               		var json = JSON.parse(modelvalue); 
                    viewModelCompany.model.__status = 'update';
                    $.ajax({ 
    							url: "${base.contextPath}/hpms/mdm/BpGeneral/updateBpGeneral?bpId="+custBpId,
    							type:"POST",
    							dataType:"json",
    							contentType:"application/json",
    							data:  kendo.stringify(json),
    				 			success: function(data){
											if (data.success) {
												kendo.ui.showInfoDialog({
													message : '<@spring.message "hap.tip.success"/>'
												});
												lookCompany();
											} else {
												kendo.ui.showInfoDialog({
													message : '失败!'
												});
											}
      						}});
      						}
            };
            
            
            
            //选择个人时的一般信息from的修改       
            function updatePersonage(){
					if(viewModel.model.groupId==''||viewModel.model.groupId==null){
            				kendo.ui.showInfoDialog({
                				message:'<@spring.message "hpms.mdm.project.groupname"/><@spring.message "hpms.mdm.notnull"/>'
           				 })
        			}else if(viewModelPersonage.model.fullName==''||viewModelPersonage.model.fullName==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.name"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelPersonage.model.contactMobile==''||viewModelPersonage.model.contactMobile==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "employee.mobile"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelPersonage.model.credentialType==''||viewModelPersonage.model.credentialType==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.credentialtype"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else if(viewModelPersonage.model.credentialNumber==''||viewModelPersonage.model.credentialNumber==null){
            			kendo.ui.showInfoDialog({
                			message:'<@spring.message "hpms.mdm.bpgeneral.credentialnumber"/><@spring.message "hpms.mdm.notnull"/>'
            				})
       				}else {
               		var modelvalue = kendo.stringify(viewModelPersonage.model);
               		var json = JSON.parse(modelvalue); 
                    viewModelPersonage.model.__status = 'update';
                    $.ajax({ 
    							url: "${base.contextPath}/hpms/mdm/BpGeneral/updateBpGeneral?bpId="+custBpId,
    							type:"POST",
    							dataType:"json",
    							contentType:"application/json",
    							data:  kendo.stringify(json),
    				 			success: function(data){
											if (data.success) {
												kendo.ui.showInfoDialog({
													message : '<@spring.message "hap.tip.success"/>'
												});
												lookPersonage();
											} else {
												kendo.ui.showInfoDialog({
													message : '失败!'
												});
											}
      						}});
      						}
            }
			//启用Tab页	
			function enableTabTrue(){
					$('#sale').removeClass('k-state-disabled');
			    	$('#relation').removeClass('k-state-disabled');
			}
			//禁用头部from			
			function enablePlanTrip(){
			    $("#customerType").data("kendoDropDownList").enable(false);
    	   		$("#customerType").css("background", "#DDDDDD");
    	   		$("#customerNumber").attr("disabled",true);
    	   		$("#customerNumber").css("color", "#DDDDDD");
    	   		$("#groupId").data("kendoComboBox").readonly(true);
    	   		$("#cancel").attr("disabled",true);	
		  };
		  //禁用一般信息from
		  function lookCompany(){
		  $("#customerType").data("kendoDropDownList").enable(false);
		  	    //$("#customerType").parent().removeClass("k-state-default").addClass("k-state-disabled").unbind();
    	       $("#customerType").css("background", "#DDDDDD");
    	       $("#customerNumber").attr("disabled",true);
    	       $("#customerNumber").css("color", "#DDDDDD");
    	 	   $("#groupId").data("kendoComboBox").enable(false);
    	   	   $("#companyName").attr("disabled",true);
    	   	   $("#companyName").css("color", "#DDDDDD");
    	   	   $("#companyType").data("kendoDropDownList").enable(false);
    	   	   $("#companyType").css("color", "#DDDDDD");
    	   	   $("#contactMo").attr("disabled",true);
    	   	   $("#contactMo").css("color", "#DDDDDD");
    	   	   $("#Tel").attr("disabled",true);
    	   	   $("#Tel").css("color", "#DDDDDD");
		       $("#cusDocumentType").data("kendoDropDownList").enable(false);
    	   	   $("#cusDocumentType").css("background", "#DDDDDD");
    	   	   $("#credNumber").attr("disabled",true);
    	   	   $("#credNumber").css("color", "#DDDDDD");
    	   	   $("#Email").attr("disabled",true);
    	   	   $("#Email").css("color", "#DDDDDD");
    	   	   $("#faxs").attr("disabled",true);
    	   	   $("#faxs").css("color", "#DDDDDD");
    	   	   $("#updateCompany").attr("disabled",true);
		  };
		  //客户类型为个人的时候,一般信息tab页中的字段禁用
		  function lookPersonage(){
		   $("#customerType").data("kendoDropDownList").enable(false);
		   $("#customerType").css("background", "#DDDDDD");
    	  $("#customerNumber").attr("disabled",true);
    	  $("#customerNumber").css("color", "#DDDDDD");
    	 	$("#groupId").data("kendoComboBox").enable(false);
		       $("#fullName").attr("disabled",true);
    	   	   $("#fullName").css("color", "#DDDDDD");
    	   	   $(".gender").attr("disabled",true);
    	   	   $(".gender").css("color", "#DDDDDD");
    	   	   $("#contactMobile").attr("disabled",true);
    	   	   $("#contactMobile").css("color", "#DDDDDD");
    	   	   $("#startTime").data("kendoDatePicker").enable(false);
    	   	   $("#startTime").css("color", "#DDDDDD");
    	   	   $("#credentialType").data("kendoDropDownList").enable(false);
    	   	   $("#credentialType").css("background", "#DDDDDD");
    	   	   $("#credentialNumber").attr("disabled",true);
    	   	   $("#credentialNumber").css("color", "#DDDDDD");
    	   	   $("#contactTel").attr("disabled",true);
    	   	   $("#contactTel").css("color", "#DDDDDD");
    	   	   $("#officeNumber").attr("disabled",true);
    	   	   $("#officeNumber").css("color", "#DDDDDD");
    	   	   $("#country").data("kendoDropDownList").enable(false);
    	   	   $("#country").css("color", "#DDDDDD");
    	   	   $("#nation").data("kendoDropDownList").enable(false);
    	   	   $("#nation").css("color", "#DDDDDD");
    	   	   $("#placeOfOrigin").attr("disabled",true);
    	   	   $("#placeOfOrigin").css("color", "#DDDDDD");
    	   	   $("#residenza").attr("disabled",true);
    	   	   $("#updatePersonage").attr("disabled",true);
    	   	   $("#residenza").css("color", "#DDDDDD");
    	   	   $("#contactEmail").attr("disabled",true);
    	   	   $("#contactEmail").css("color", "#DDDDDD");
    	   	   $("#fax").attr("disabled",true);
    	   	   $("#fax").css("color", "#DDDDDD");
		  };
		  
		  //点击编辑,不再禁用选择个人时的from
		  function editCompany(){
    	   	   $("#companyName").attr("disabled",false);
    	   	   $("#companyName").css("color", "#000000");
    	   	   $("#companyType").data("kendoDropDownList").enable(true);
    	   	   $("#companyType").css("color", "#000000");
    	   	   $("#contactMo").attr("disabled",false);
    	   	   $("#contactMo").css("color", "#000000");
    	   	   $("#Tel").attr("disabled",false);
    	   	   $("#Tel").css("color", "#000000");
		       $("#cusDocumentType").data("kendoDropDownList").enable(true);
    	   	   $("#credNumber").attr("disabled",false);
    	   	   $("#credNumber").css("color", "#000000");
    	   	   $("#Email").attr("disabled",false);
    	   	   $("#Email").css("color", "#000000");
    	   	   $("#faxs").attr("disabled",false);
    	   	   $("#faxs").css("color", "#000000");
    	   	   $("#updateCompany").attr("disabled",false);
		  }
		  
		  
		  
		  function editPersonage(){
		       $("#fullName").attr("disabled",false);
    	   	   $("#fullName").css("color", "#000000");
    	   	   $(".gender").attr("disabled",false);
    	   	   $(".gender").css("color", "#000000");
    	   	   $("#contactMobile").attr("disabled",false);
    	   	   $("#contactMobile").css("color", "#000000");
    	   	   $("#startTime").data("kendoDatePicker").enable(true);
    	   	   $("#startTime").css("color", "#000000");
    	   	   $("#credentialType").data("kendoDropDownList").enable(true);
    	   	   $("#credentialType").css("background", "#000000");
    	   	   $("#credentialNumber").attr("disabled",false);
    	   	   $("#credentialNumber").css("color", "#000000");
    	   	   $("#contactTel").attr("disabled",false);
    	   	   $("#contactTel").css("color", "#000000");
    	   	   $("#officeNumber").attr("disabled",false);
    	   	   $("#officeNumber").css("color", "#000000");
    	   	   $("#country").data("kendoDropDownList").enable(true);
    	   	   $("#country").css("color", "#000000");
    	   	   $("#nation").data("kendoDropDownList").enable(true);
    	   	   $("#nation").css("color", "#000000");
    	   	   $("#placeOfOrigin").attr("disabled",false);
    	   	   $("#placeOfOrigin").css("color", "#000000");
    	   	   $("#residenza").attr("disabled",false);
    	   	   $("#residenza").css("color", "#000000");
    	   	   $("#contactEmail").attr("disabled",false);
    	   	   $("#contactEmail").css("color", "#000000");
    	   	   $("#fax").attr("disabled",false);
    	   	   $("#fax").css("color", "#000000");
    	   	   $("#updatePersonage").attr("disabled",false);
		  }
		  if (islook) {
      		 $.ajax({
           	   url    : '${base.contextPath}/hpms/mdm/BpGeneral/queryBycustomerId?customerId=${RequestParameters.customerId!0}',
           	   success: function (args) {
	            var a0 = args.rows[0] || {};
	            
	            enableTabTrue();
	            viewModel.model.set("customerType",args.rows[0].customerType);
	            viewModel.model.set("customerNumber",args.rows[0].customerNumber);
	            viewModel.model.set("groupId",args.rows[0].groupId);
	            console.log(enableFlag)
	            var customerType = viewModel.model.customerType;
	            if ("COMPANY" == customerType) {
				   $("#company").show();
				   $("#relation").hide();
				   $("#personage").hide();
				   $("#sales").hide();
				   $("#saleGrid").parent().show();
				   if(enableFlag == "Y"){
				   	$("#editCompany").show();
				   	$("#updateCompany").show();
				   }else if(enableFlag=="N"){
				   	$("#editCompany").hide();
				   	$("#updateCompany").hide();
				   	//根据grid索引动态隐藏列
				   	$("#saleGrid").data("kendoGrid").hideColumn(0);
				  }
				   $("#saveCompany").hide();
				   $("#resetCompany").hide();
					for (var k in a0) {
	                viewModelCompany.model.set(k, a0[k]);
	             	}
	             	lookCompany();
				}else if("PERSON" == customerType){
					$("#personage").show();
					$("#relation").show();
					$("#company").hide();
					$("#saleGrid").parent().show();
					$("#retaions").show();
					$("#personnel").hide();
					if(enableFlag == "Y"){
						$("#editPersonage").show();
						$("#updatePersonage").show();
				 }else if(enableFlag == "N"){
						$("#editPersonage").hide();
						$("#updatePersonage").hide();
				   		$("#savePeople").hide();
						$("#saleGrid").data("kendoGrid").hideColumn(0);
						$("#bpRetaionGrid").data("kendoGrid").hideColumn(1);
						$("#retaionGrid").data("kendoGrid").hideColumn(1);
					}
					$("#cancel").hide();
					$("#savePersonage").hide();
					$("#sales").hide();
				   	for (var k in a0) {
	                	viewModelPersonage.model.set(k, a0[k]);
	             	}
	             	lookPersonage();
				}
	        }
       });
       };
       
       
       
       //新建联系人
       function savePeople(custBpId){
          $("#newContact").kendoWindow({
            actions: ["Close"],
            title: $l('<@spring.message "hap.new"/><@spring.message "company.contactperson"/>'),
            draggable: true,
            height: "300px",
            width: "630px",
            close: function(){
               //$("#editWin").empty();
            },
            content: "${base.contextPath}/mdm/customer_new_contact.html?isedit=0&fromBpId="+custBpId,
            iframe: true,
            modal: true
        });
        var win = $("#newContact").data("kendoWindow");
        win.center().open();
       };
       
       
       
       //修改联系人
       function updateCantact(custBpId,bpId){
          $("#newContact").kendoWindow({
            actions: ["Close"],
            title: $l('<@spring.message "hap.edit"/><@spring.message "company.contactperson"/>'),
            draggable: true,
            height: "300px",
            width: "630px",
            close: function(){
               //$("#editWin").empty();
            },
            content: "${base.contextPath}/mdm/customer_new_contact.html?isedit=1&fromBpId="+custBpId+"&bpId="+bpId,
            iframe: true,
            modal: true
        });
        console.log("11111"+bpId);
        var win = $("#newContact").data("kendoWindow");
        win.center().open();
       };
       
       function close(){
          window.parent.$("#newDialog").data("kendoWindow").close();
       };
       
       //新建关系
       function updateReation(bpId,custBpId){
          $("#editRelation").kendoWindow({
            actions: ["Close"],
            title: $l('新建关系'),
            draggable: true,
            height: "180px",
            width: "330px",
            close: function(){
               //$("#editWin").empty();
            },
            content: "${base.contextPath}/mdm/customer_new_relationship.html?isedit=0&bpId="+bpId+"&fromBpId="+custBpId,
            iframe: true,
            modal: true
        });
        var win = $("#editRelation").data("kendoWindow");
        win.center().open();
       }
       
       
       //设置默认值
       if(isedit==0&&!islook){
        	viewModelRelationship.model.set("icmFlag",0);
        	viewModelbpGender.model.set("personGender","未知");
        	viewModelPersonage.model.set("personGender","未知");

   }
	</script>
</body>
</html>